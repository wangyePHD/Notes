
## Multifold Cross-modal Masked Pre-training åˆæœŸå®éªŒæ–¹æ¡ˆè®¾è®¡

### å®éªŒä¸€ Vanilla PiMAE Pre-training
ç”±äºtorchç‰ˆæœ¬çš„ä¸åŒï¼ŒåŒæ—¶åŸå§‹repoä¹Ÿæ²¡æœ‰ç»™å‡ºå…·ä½“çš„torchç‰ˆæœ¬ä¿¡æ¯ï¼Œå½“ä½¿ç”¨å’ŒPiMAEç›¸åŒçš„batchsize (128)è®¾ç½®æ—¶ï¼Œä¼šæŠ¥é”™ï¼Œè¿™ä¸ªerroræ˜¯ç”±äºtorchç‰ˆæœ¬ä¸åŒå¸¦æ¥çš„bugã€‚å½“é™ä½batchsizeè‡³100æ—¶ï¼Œå¯ä»¥æ­£å¸¸é¢„è®­ç»ƒã€‚

#### ç–‘é—®
1. ä¸ºä»€ä¹ˆç»è¿‡SUN RGB-Dæ•°æ®é›†çš„é¢„è®­ç»ƒä¹‹åï¼Œåœ¨SUN RGB-Dæ•°æ®é›†ä¸Šå¾®è°ƒ3DETRè¿˜éœ€è¦1080è½®å‘¢ï¼Ÿæ¯•ç«Ÿ3DETRçš„training from the scratchæ‰æ˜¯1080,é‚£è¿™æ ·çš„è¯ï¼Œé¢„è®­ç»ƒçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ
    * åœ¨PointMAEçš„issueä¸­ï¼ŒåŸä½œè€…è¿›è¡Œäº†å›å¤ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯çœ‹æ•ˆæœï¼Œfinetuneçš„epochå¦‚æœè¾ƒå°‘çš„è¯ï¼Œé‚£æ•ˆæœå°±ä¸è¡Œã€‚

### 20230411 å®éªŒ PointMAE vs 2-fold PointMAE

**Baseline**:
é‡‡ç”¨åŸå§‹çš„PointMAEæ¨¡å‹ï¼Œå‘è¡¨äºECCV2022ã€‚å±äºçº¯ç‚¹äº‘æ¨¡æ€çš„mask pre-trainingæ¨¡å‹ã€‚å¹¶ä¸æ˜¯å½“å‰ç‚¹äº‘è‡ªç›‘ç£é¢„è®­ç»ƒé¢†åŸŸçš„SOTA.
![111](../../../00_Assets/2023-04-11-10-21-01.png)
**2-fold PointMAE**:
æ¯ä¸€ä¸ªç‚¹äº‘random maskä¸¤æ¬¡ï¼Œå…¶ä½™settingså‡å’Œbaselineä¿æŒä¸€è‡´ã€‚

**é¢„è®­ç»ƒæ•°æ®é›†**ï¼š
1. ShapeNet-55

**ä¸‹æ¸¸ä»»åŠ¡**ï¼š
1. ModelNet40 finetuning task
2. ModelNet40 10-fold few-shot learning task
    * 5-way, 10-shot 
    * 5-way, 20-shot
    * 10-way, 10-shot
    * 10-way, 20-shot

**å®éªŒç»“æœ**
1. Finetuning on ModelNet40 dataset.

|  Methods | Accuracy  |
|---|---|
| <font color=red>ReCon (SOTA)</font> | <font color=red>94.7%</font> |
| Point-MAE | **93.8%**  |
| 2-fold Point-MAE | 93.3% |
| 3-fold Point-MAE | 93.23% |



å‘ç°ï¼š
* 2-fold Point-MAEåœ¨modelnetä¸Šè¿›è¡Œfinetuningï¼Œæœ€ç»ˆçš„æ•ˆæœæœ‰æ‰€ä¸‹é™ã€‚ç›®å‰åˆ†æå‡ºæ¥çš„åŸå› æ˜¯å¯èƒ½æ˜¯2-fold PointMAEçš„é¢„è®­ç»ƒæ—¶é—´è¿‡é•¿ï¼Œä»è€Œå¯¼è‡´è¿‡æ‹Ÿåˆã€‚ç¼©çŸ­é¢„è®­ç»ƒæ—¶é•¿çš„å®éªŒç›®å‰æ­£åœ¨åˆ·ã€‚
* ä¹Ÿæœ‰å¯èƒ½æ˜¯2æ¬¡random maskä¹‹åï¼Œè®­ç»ƒç›®æ ‡ä¸ä¸€è‡´é€ æˆã€‚



2. Few-shot learning on ModelNet40 dataset.

|  Methods | 5-ways,10-shot  | 5-ways,20-shot | 10-ways,10-shot | 10-ways,20-shot  |
|---|---|---|---|---|
|  <font color=red>ReCon (SOTA)</font> | <font color=red> 97.3%$\pm$1.9</font> | <font color=red> 98.9%$\pm$1.2 </font> | <font color=red>93.3%$\pm$3.9</font> | <font color=red>95.8%$\pm$3.0</font>  |
|  Point-MAE | 96.3 $\pm$ 2.5 | 97.8 $\pm$ 1.8 | 92.6 $\pm$ 4.1 | 95.0 $\pm$ **3.0**  |
|  2-fold Point-MAE | **96.6** $\pm$ 2.62 | **98.0** $\pm$ **1.0** | 92.8 $\pm$ 3.96 | 95.2 $\pm$ 3.11  |
|  3-fold Point-MAE | 96.5 $\pm$ **2.06** | **98.0** $\pm$ 1.34 | **92.85** $\pm$ **3.74** | **95.35** $\pm$ 3.17  |

å‘ç°ï¼š
* 2-fold PointMAEåœ¨few-shot learningä¸Šå‡å¸¦æ¥äº†æå‡ã€‚å¯èƒ½æ˜¯å› ä¸ºé¢„è®­ç»ƒé˜¶æ®µï¼Œå¯¹äºæ¯ä¸€ä¸ªshapeéƒ½å­¦ä¹ äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œæœ€ç»ˆå­¦å‡ºæ¥çš„representationåœ¨å°æ ·æœ¬è®¾ç½®ä¸‹æ€§èƒ½æ›´ä¼˜ã€‚


3. Part Segmentation task on ShapeNetCore dataset

|  Method | $mIoU_C$  |  $mIoU_I$  |
|---|---|---|
|  PointMAE  | ---  |  86.10%  |
|  2-fold PointMAE | 84.80%  |  86.22%  |
|  ReCon (CVPR23)   |  84.80%  | 86.40%  |
|  PointM2AE (NIPS22) | 84.86%  |  86.51%  |
|  I2P-MAE (CVPR23)  | 85.15%  |  86.76%    |


4. ScanObjectNN åˆ†ç±»ä»»åŠ¡

|  Method | ACC  |
|---|---|
|  PointMAE  |  85.18% |
|  2-fold PointMAE | 84.73% |
|  I2P-MAE (CVPR23)  | 90.11% |
|  ReCon (CVPR23)  | 90.63% |




~~**ç°é˜¶æ®µé—®é¢˜**~~
1. ~~multifold mask setting ç›¸å¯¹äºvanilla PointMAEå¢å¤§äº†batchsizeï¼ŒåŒæ—¶é¢„è®­ç»ƒé˜¶æ®µ+å¾®è°ƒå¤§æ¦‚éœ€è¦30ä¸ªå°æ—¶ï¼Œå¤ªæ…¢äº†ã€‚~~
    * ~~ç›®å‰çš„è§£å†³åŠæ³•å°±æ˜¯è®¾è®¡ä¸€ä¸ªåœ¨å°æ•°æ®é›†ä¸Šé¢„è®­ç»ƒçš„å®éªŒæ–¹æ¡ˆ~~
    * ~~è¿ç§»è‡³4*A10æœåŠ¡å™¨è¿›è¡Œå®éªŒï¼ˆè¿è¡Œä¸­ï¼‰~~
2. ~~few-shotçš„å®éªŒç»†èŠ‚~~



**Future work**
1. **2-fold PointMAEä¸‹æ¸¸å®éªŒ**
    * Finetuning classification on ScanObjectNN ğŸ”¥
    * Finetuning segmentation on ShapeNetCore ğŸ”¥

2. **3-fold PointMAEä¸‹æ¸¸å®éªŒ**
    * Finetuning on ModelNet40 ğŸ”¥
    * Finetuning classification on ScanObjectNN ğŸ§Š
    * Finetuning segmentation on ShapeNetCore ğŸ§Š

3. **å°æ•°æ®é›†å®éªŒ**
    * é¢„è®­ç»ƒæ•°æ®ShapeNet ---> 1/10 ğŸ”¥
    * ä¸‹æ¸¸fintiuneæ•°æ® ---> 1/10 ğŸ”¥
    * å¿«é€ŸéªŒè¯ç»“è®º ğŸ§Š



---

### 2023.04.12-2023.04.18 å®éªŒè®°å½•

#### **Few-shot learning setup**
1. Support setæ„é€ 
    * ä»æ•°æ®é›†ä¸­éšæœºé‡‡Kä¸ªclass
    * æ¯ä¸ªç±»éšæœºé‡‡Mä¸ªæ ·æœ¬
    * M*Kä¸ªæ ·æœ¬æ„æˆ Support Set
    * ç”¨äºè®­ç»ƒ
2. Query setæ„é€ 
    * ä»Kä¸ªclassçš„æ•°æ®ä¸­ï¼Œæ¯ä¸ªclasséšæœºé‡‡20 unseen samples
    * disjoint from support set

3. æ¨¡å‹
    * still end-to-end finetune with **Feature Encode+MLP** classification for few-shot learning


#### å°æ•°æ®é›†ä¸‹é¢„è®­ç»ƒè®¾ç½® ğŸ”¥
```markdown
å‚è€ƒ Understanding Masked Image Modeling via Learning Occlusion Invariant Featureï¼Œå¼ ç¥¥é›¨ã€‚
è®ºæ–‡ä¸­åšäº†ä¸€ä¸ªå°æ•°æ®é›†ä¸Šçš„å®éªŒ Table 5ï¼Œå‘ç°å°æ•°æ®é›†ä¸‹ï¼ŒMAEä»ç„¶æœ‰æ•ˆã€‚ä½†è¦é˜²æ­¢è¿‡æ‹Ÿåˆã€‚
```
![](../../../00_Assets/2023-04-12-22-09-58.png)


1. ShapeNet-55 scale to 1/10
2. ModelNet40æ•°æ®ä¸å˜
3. ä¸ºé˜²æ­¢é¢„è®­ç»ƒè¿‡æ‹Ÿåˆï¼Œç¼©çŸ­epochä¸º50ï¼Œ100
4. ä¸‹æ¸¸é‡‡ç”¨ModelNet40 finetuningå’Œfew-shot learningä»»åŠ¡, ç¡®å®šå°æ•°æ®é›†ä¸‹çš„æœ€ä¼˜pre-training epoch
    * vanilla PointMAE
        * ~~epoch 50 model finetuning on ModelNet40~~
        * ~~epoch 100 model finetuning on ModelNet40~~
        * ~~epoch 50 model few-shot on ModelNet40~~
        * ~~epoch 100 model few-shot on ModelNet40~~
    * 2-fold PointMAE
        * ~~epoch 50 model finetuning on ModelNet40 ğŸ”¥~~
        * ~~epoch 50 model few-shot on ModelNet40~~
        * ~~epoch 100 model finetuning on ModelNet40 ğŸ”¥~~
        * ~~epoch 100 model few-shot on ModelNet40~~
5. æ–°å®éªŒ
    * éªŒè¯1/10é¢„è®­ç»ƒshapenetæ•°æ®é›†ä¸‹ï¼Œ200 epochå’Œ300 epochä¸‹çš„ç»“æœã€‚ğŸ”¥
        * æ˜¯ä¸æ˜¯å°æ•°æ®é›†ä¸‹ï¼Œå°±å¯ä»¥è¾¾åˆ°è¿™æ ·çš„ç»“æœ


|Method | Epoch  | 5-way, 10-shot  | Finetuning  Accuracy  |
|---|---|---|---|
| PointMAE  | 50  | 92.3% $\pm$ 2.83  | 92.54% |
| PointMAE  | 100  | 95.2% $\pm$ 2.52 | 92.54% |
| PointMAE  | 200  | 94.9% $\pm$ 2.43 | 92.79% |
| PointMAE  | 300  | 95.1% $\pm$ 2.26 | 91.21% |
| 2fold-PointMAE  | 50  |93.2% $\pm$ 3.79 | 92.34% |
| 2fold-PointMAE  | 100  | 95.3% $\pm$ 2.65 | 92.50% |

ä»ä¸Šè¡¨å‰å››è¡Œè¡¨æ˜ï¼Œåœ¨å°æ•°æ®é›†ï¼ˆ1/10 shapenetï¼‰ä¸‹é¢„è®­ç»ƒPointMAE 100epochè¾¾åˆ°æœ€ä½³ã€‚ç»§ç»­è®­ç»ƒ200epochæˆ–è€…300epochï¼Œéƒ½æ— æ³•å®ç°åŒæŒ‡æ ‡æ•ˆæœçš„æå‡ã€‚è¯´æ˜åœ¨å½“å‰çš„æ•°æ®é‡ä¸‹ï¼Œä»æ—¶é—´æ¶ˆè€—å’Œæ€§èƒ½çš„trade-offæ¥çœ‹ï¼Œ100 epochè¿›è¡Œé¢„è®­ç»ƒå·²ç»enoughã€‚åç»­çš„å®éªŒå¯è€ƒè™‘100 epochçš„è®¾ç½®ã€‚
 





#### ç¡®å®šæœ€ä¼˜é¢„è®­ç»ƒepoch for 2-fold PointMAE ğŸ”¥
|  Methods | Epoch  | 5-ways,10-shot  | 5-ways,20-shot | 10-ways,10-shot | 10-ways,20-shot  |
|---|---|---|---|---|---|
| 2fold PointMAE  | 300  | 96.6 $\pm$ 2.62 | 98.0 $\pm$ 1.0   | 92.8 $\pm$ 3.96  | 95.2 $\pm$ 3.11  |
| 2fold PointMAE  | 150  | 95.4 $\pm$ 3.17 | 97.6 $\pm$ 1.43  | 91.5 $\pm$ 4.23  | 94.6 $\pm$ 3.53  |
| 2fold PointMAE  | 200  | 95.9$\pm$2.62  | 97.8$\pm$1.6  | 92.7$\pm$4.22  |  20230413åœ¨è·‘ A10 |

å®éªŒç»“è®ºï¼š
1. 2-fold MAEåœ¨éƒ¨åˆ†ä¸‹æ¸¸ä»»åŠ¡çš„æ•ˆæœä¸å¥½ï¼Œå¯èƒ½ä¸æ˜¯ç”±äºé¢„è®­ç»ƒæ—¶é—´è¿‡é•¿å¯¼è‡´çš„è¿‡æ‹Ÿåˆé€ æˆçš„ã€‚æ›´å°‘çš„é¢„è®­ç»ƒepoch 150, 200å¾—åˆ°çš„æ•ˆæœæ›´å·®ã€‚
2. å¾ˆæœ‰å¯èƒ½ç°åœ¨è¿™ç§å®ç°æ–¹å¼ï¼ˆdouble batchï¼‰è¿˜éœ€è¦æ›´å¤§çš„pretraining epoch,è¿™æ˜¯å› ä¸ºå½“å‰çš„å®ç°æ–¹å¼ç›¸å½“äºå°†æ•´ä¸ªæ•°æ®é›†å¢å¤§äº†ä¸¤å€ã€‚
3. è¿˜æ˜¯è¦å‚è€ƒEMAEçš„å®ç°æ–¹å¼ã€‚

#### ç ”ç©¶æ–°maskæ–¹å¼å®éªŒ
```markdown
æ ¹æ®æ–‡ç«  Efficient Masked Autoencoders with self-consistencyä¸­æåˆ°çš„multifoldçš„maskæ–¹å¼ï¼Œå¼€å±•ä»¥ä¸‹å®éªŒï¼š
1. å°†åŸæ¥çš„double input æ”¹ä¸ºdouble random mask (2-fold)
2. å¯¹æ¯”å®éªŒ1,å°†double random maskæ”¹ä¸ºEMAEçš„å½¢å¼ã€‚
3. å¯¹æ¯”å®éªŒ2,å®éªŒ1ï¼Œç»™å‡ºç»“è®º
4. å‚è€ƒè®ºæ–‡ Multi-scale Geometry-aware Transformer for 3D Point Cloud Classification å¼•å…¥multi-scaleçš„ pointclouds batch, è¿›è¡Œå®éªŒã€‚
```


```mermaid
graph LR
   Input(è¾“å…¥ N*3) --->|double| 2-Fold[2N*3]
   2-Fold --->|random mask| Mask(Output)
```


```mermaid
graph LR
   Input(è¾“å…¥ N*3) --->|double random mask| Output(Output)
```

|Method | Epoch  | 5-way, 10-shot  | Finetuning  Accuracy  |
|---|---|---|---|
| PointMAE  | 50  | 92.3% $\pm$ 2.83 | 92.54% |
| 2fold-PointMAE  | 50  |93.2% $\pm$ 3.79 | 92.34% |
| 2fold Random mask  | 50   | 92.2% $\pm$ 4.17 | 92.14% |
| PointMAE           | 100 | 95.2% $\pm$ 2.52 | 92.54% |
| 2fold-PointMAE     | 100  | 95.3% $\pm$ 2.65 | 92.50% |
| 2fold Random mask  | 100  | 94.6% $\pm$ 2.58 |  92.63%|
| 4fold Random mask  | 100  | 94.4% $\pm$ 2.69 |  |

#### ç ”ç©¶ä¸åŒepochä¸‹ 2fold random maskçš„æ€§èƒ½


|Method | Epoch  | 5-way, 10-shot  | Finetuning  Accuracy  |
|---|---|---|---|
| 2fold Random mask  | 50   | 92.2% $\pm$ 4.17 | 92.14% |
| 2fold Random mask  | 100  | 94.6% $\pm$ 2.58 |  92.63%|
| 2fold Random mask  | 200  |  |  |
| 2fold Random mask  | 300  |  |  |


#### ç ”ç©¶ä¸åŒepochä¸‹ï¼Œ2fold random maskå’Œvanilla pointMAEå¯¹æ¯”

|Method | Epoch  | 5-way, 10-shot  | Finetuning  Accuracy  |
|---|---|---|---|
| PointMAE  | 50  | 92.3% $\pm$ 2.83 | 92.54% |
| 2fold Random mask  | 50   | 92.2% $\pm$ 4.17 | 92.14% |
| PointMAE           | 100 | 95.2% $\pm$ 2.52 | 92.54% |
| 2fold Random mask  | 100  | 94.6% $\pm$ 2.58 |  92.63%|
| PointMAE  | 200  | 94.9% $\pm$ 2.43 | 92.79% |
| 2fold Random mask  | 200  |  | |
| PointMAE  | 300  | 95.1% $\pm$ 2.26 | 91.21% |
| 2fold Random mask  | 300  |  | |

#### ç ”ç©¶ä¸åŒmask foldæ•°çš„å½±å“
|Method | Epoch  | 5-way, 10-shot  | Finetuning  Accuracy  |
|---|---|---|---|
| 2fold Random mask  | 100  | 94.6% $\pm$ 2.58 |  92.63%|
| 4fold Random mask  | 100  | 94.4% $\pm$ 2.69 |  92.46%|


#### ç ”ç©¶å½“å‰2fold random maskçš„å¼Šç«¯

å½“å‰çš„ç‚¹äº‘ä¼šè¢«FPS+KNNç®—æ³•åˆ†æˆ64ä¸ªtoken patch, æŒ‰ç…§å½“å‰0.6çš„æ©ç ç‡ï¼Œå¤§æ¦‚ä¼šæœ‰28ä¸ªpatchæ˜¯visçš„ã€‚
å¯¹äºåŒä¸€ä¸ªç‚¹äº‘ï¼Œè¿ç»­random maskä¸¤æ¬¡ï¼Œå¾—åˆ°çš„ä¸¤ä¸ªvis versionä¸­ï¼Œç»è¿‡è®¡ç®—ï¼Œå¤§çº¦40%æ˜¯é‡å ã€‚è¿™æ ·çš„è¯ï¼Œå¯èƒ½ä¿¡æ¯å°±æœ‰äº›å†—ä½™ã€‚

äºæ˜¯ï¼Œæ ¹æ®è®ºæ–‡EMAEä¸­æå‡ºçš„maskç­–ç•¥ï¼Œè¿›è¡Œå¤ç°ï¼Œè¿è¡Œå®éªŒã€‚ç»“æœå¦‚ä¸‹ï¼š
|Method | Epoch | Finetuning  Accuracy  |
|---|---|---|
| PointMAE      | 100    |  92.54%|
| PointMAE      | 200    |  92.79%|
|  Double Input | 100    |  92.50%|
|  2-fold random mask | 100 |  92.63%| 
|  2-fold EMAE  | 100    |  92.79%|
